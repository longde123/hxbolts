<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>hxbolts by restorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">hxbolts</h1>
      <h2 class="project-tagline">Deal with async tasks like a boss</h2>
      <a href="https://github.com/restorer/hxbolts" class="btn">View on GitHub</a>
      <a href="https://github.com/restorer/hxbolts/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/restorer/hxbolts/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><img src="images/hxbolts-logo.png" alt="Logo"></p>

<p>hxbolts is a port of a "tasks" component from java library named Bolts.
A task is kind of like a JavaScript Promise, but with different API.</p>

<p>While original java library is about keeping long-running operations out of the UI thread,
current version of hxbolts is more about transforming async callback hell into nice looking code.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<pre><code>haxelib install hxbolts
</code></pre>

<h2>
<a id="lets-talk" class="anchor" href="#lets-talk" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Let's talk</h2>

<p>Imagine you have to delete all comments from blog while player playing in your game, mwahahaha <g-emoji alias="smiling_imp" fallback-src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f608.png">ðŸ˜ˆ</g-emoji> . But server API has only 4 methods:</p>

<ol>
<li>Authorize;</li>
<li>Get all posts ids;</li>
<li>Get all comments ids for specific post;</li>
<li>Delete specific comment by id.</li>
</ol>

<p>Let you have a function for making async requests:</p>

<div class="highlight highlight-source-haxe-2"><pre><span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">function</span> <span class="pl-en">makeRequestAsync</span>(
    url : <span class="pl-c1">String</span>,
    callback : <span class="pl-c1">String</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> <span class="pl-c1">Void</span>
) : <span class="pl-c1">Void</span> { <span class="pl-k">...</span> }</pre></div>

<p>Usually code will look like:</p>

<div class="highlight highlight-source-haxe-2"><pre><span class="pl-k">var</span> <span class="pl-en">token</span> : <span class="pl-c1">String</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;

makeRequestAsync(<span class="pl-s"><span class="pl-pds">"</span>http://blog.tld/api/authorize?user=me<span class="pl-pds">"</span></span>, <span class="pl-k">function</span>(result : <span class="pl-c1">String</span>) : <span class="pl-c1">Void</span> {
    <span class="pl-k">try</span> {
        token <span class="pl-k">=</span> <span class="pl-c1">Reflect.</span>field(<span class="pl-c1">Json.</span>parse(result), <span class="pl-s"><span class="pl-pds">"</span>token<span class="pl-pds">"</span></span>);
    } <span class="pl-k">catch</span> (e : <span class="pl-c1">Dynamic</span>) {
        <span class="pl-k">trace</span>(<span class="pl-s"><span class="pl-pds">"</span>Error occurred : <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">Std.</span>string(e));
        <span class="pl-k">return</span>;
    }

    makeRequestAsync(<span class="pl-s"><span class="pl-pds">'</span>http://blog.tld/api/postsIds?token=<span class="pl-smi">${token}</span><span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(result : <span class="pl-c1">String</span>) : <span class="pl-c1">Void</span> {
        <span class="pl-k">var</span> ids : <span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">Int</span><span class="pl-k">&gt;</span>;

        <span class="pl-k">try</span> {
            ids <span class="pl-k">=</span> <span class="pl-k">cast</span> <span class="pl-c1">Json.</span>parse(result);
        } <span class="pl-k">catch</span> (e : <span class="pl-c1">Dynamic</span>) {
            <span class="pl-k">trace</span>(<span class="pl-s"><span class="pl-pds">"</span>Error occurred : <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">Std.</span>string(e));
            <span class="pl-k">return</span>;
        }

        <span class="pl-k">var</span> results <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;</span>();

        <span class="pl-k">for</span> (id in ids) {
            makeRequestAsync(<span class="pl-s"><span class="pl-pds">'</span>http://blog.tld/api/commentsIds?token=<span class="pl-smi">${token}</span>&amp;postId=<span class="pl-smi">${id}</span><span class="pl-pds">'</span></span>, <span class="pl-k">function</span>(result : <span class="pl-c1">String</span>) : <span class="pl-c1">Void</span> {
                results.push(result);

                <span class="pl-k">if</span> (results.length <span class="pl-k">==</span> ids.length) {
                    <span class="pl-c">// ...</span>
                }
            });
        }
    });
});</pre></div>

<p>Uh oh... And I donâ€™t even started deletion process.</p>

<h2>
<a id="hxbolts-coming-to-the-rescue" class="anchor" href="#hxbolts-coming-to-the-rescue" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>hxbolts coming to the rescue!</h2>

<p>At first we need to <em>boltify</em> makeRequestAsync function:</p>

<div class="highlight highlight-source-haxe-2"><pre><span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-k">function</span> <span class="pl-en">makeRequestTask</span>(url : <span class="pl-c1">String</span>) : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;</span> {
    <span class="pl-k">var</span> tcs <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">TaskCompletionSource</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;</span>();

    makeRequestAsync(url, <span class="pl-k">function</span>(result : <span class="pl-c1">String</span>) : <span class="pl-c1">Void</span> {
        tcs.setResult(result);
    });

    <span class="pl-k">return</span> tcs.task;
}</pre></div>

<p>The rest is easy:</p>

<div class="highlight highlight-source-haxe-2"><pre><span class="pl-k">var</span> <span class="pl-en">token</span> : <span class="pl-c1">String</span> <span class="pl-k">=</span> <span class="pl-c1">null</span>;

makeRequestTask(<span class="pl-s"><span class="pl-pds">"</span>http://blog.tld/api/authorize?user=me<span class="pl-pds">"</span></span>).onSuccessTask(<span class="pl-k">function</span>(task : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;</span>) : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;</span> {
    token <span class="pl-k">=</span> <span class="pl-c1">Reflect.</span>field(<span class="pl-c1">Json.</span>parse(task.result), <span class="pl-s"><span class="pl-pds">"</span>token<span class="pl-pds">"</span></span>);
    <span class="pl-k">return</span> makeRequestTask(<span class="pl-s"><span class="pl-pds">'</span>http://blog.tld/api/postsIds?token=<span class="pl-smi">${token}</span><span class="pl-pds">'</span></span>);
}).onSuccessTask(<span class="pl-k">function</span>(task : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;</span>) : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;&gt;</span> {
    <span class="pl-k">var</span> tasks <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;&gt;</span>();

    <span class="pl-k">for</span> (id in (<span class="pl-k">cast</span> <span class="pl-c1">Json.</span>parse(task.result) : <span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">Int</span><span class="pl-k">&gt;</span>)) {
        tasks.push(makeRequestTask(<span class="pl-s"><span class="pl-pds">'</span>http://blog.tld/api/commentsIds?token=<span class="pl-smi">${token}</span>&amp;postId=<span class="pl-smi">${id}</span><span class="pl-pds">'</span></span>));
    }

    <span class="pl-k">return</span> <span class="pl-c1">Task.</span>whenAllResult(tasks);
}).onSuccessTask(<span class="pl-k">function</span>(task : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;&gt;</span>) : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">Void</span><span class="pl-k">&gt;</span> {
    <span class="pl-k">var</span> tasks <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">String</span><span class="pl-k">&gt;&gt;</span>();

    <span class="pl-k">for</span> (response in task.result) {
        <span class="pl-k">for</span> (id in (<span class="pl-k">cast</span> <span class="pl-c1">Json.</span>parse(response) : <span class="pl-c1">Array</span><span class="pl-k">&lt;</span><span class="pl-c1">Int</span><span class="pl-k">&gt;</span>)) {
            tasks.push(makeRequestTask(<span class="pl-s"><span class="pl-pds">'</span>http://blog.tld/api/deleteComment?token=<span class="pl-smi">${token}</span>&amp;commentId=<span class="pl-smi">${id}</span><span class="pl-pds">'</span></span>));
        }
    }

    <span class="pl-k">return</span> <span class="pl-c1">Task.</span>whenAll(tasks);
}).continueWith(<span class="pl-k">function</span>(task : <span class="pl-c1">Task</span><span class="pl-k">&lt;</span><span class="pl-c1">Void</span><span class="pl-k">&gt;</span>) : <span class="pl-c1">Void</span> {
    <span class="pl-k">if</span> (task.isSuccessed) {
        <span class="pl-k">trace</span>(<span class="pl-s"><span class="pl-pds">"</span>Everything is good<span class="pl-pds">"</span></span>);
    } <span class="pl-k">else</span> {
        <span class="pl-k">trace</span>(<span class="pl-s"><span class="pl-pds">"</span>Error occurred : <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-c1">Std.</span>string(task.error));
    }
});</pre></div>

<p>Code is linear, easy to understand. It even doesnâ€™t contains try / catch blocks, because hxbolts will take care about exceptions.</p>

<p>Check out more examples at <a href="https://github.com/restorer/hxbolts">hxbolts repo</a>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/restorer/hxbolts">hxbolts</a> is maintained by <a href="https://github.com/restorer">restorer</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
